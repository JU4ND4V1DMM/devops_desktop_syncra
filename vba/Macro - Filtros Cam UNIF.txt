Sub Process_Complete()
'
' Proceso Diario Para Carga en Next
' PASO A PASO (F8) - COMPLETO (F5)

'
    
    Call RenameActiveSheet
    Call Titles

    Do
        On Error Resume Next
        Call Update_Line_Q      'Llamado a una ordenaciï¿½n de la columna con valores ACTIVADA y DESACTIVADA
        Call Filter_Q           'Delimitador de las celdas con valores separados por ; en la columna de direcciï¿½n completa
        
        If Err.Number <> 0 Then
            Err.Clear  ' Limpiar el error
            Exit Do    ' Salir del bucle si hay un error
        End If
        On Error GoTo 0  ' Restablecer el manejo de errores
    Loop


    Do
        On Error Resume Next
        Call Update_Line_AO      'Llamado a una ordenaciï¿½n de la columna con valores ACTIVADA y DESACTIVADA
        Call Filter_AO           'Delimitador de las celdas con valores separados por ; en la columna de direcciï¿½n completa
        
        If Err.Number <> 0 Then
            Err.Clear  ' Limpiar el error
            Exit Do    ' Salir del bucle si hay un error
        End If
        On Error GoTo 0  ' Restablecer el manejo de errores
    Loop
 
    Call Update
    Call Headers
    Call Dates
    
    Call ActiveLines
    Call AdjustMonitor
    Call AdjustValorScoring
    
    Call Cutter
    Call DeleteColumnsAYtoBC
    Call FinalHeaders
    
    Range("A2").Select
    
End Sub
Sub DeleteColumnsAYtoBC()
    
    ' Elimina las columnas desde AY hasta BC.
    Columns("AY:BC").Delete
    Columns("BJ").Delete
    
End Sub
Sub Cutter()

    Columns("BD:BJ").Select
    Range("BJ1").Activate
    Selection.Cut
    Range("BJ1").Select
    Selection.End(xlToRight).Select
    Selection.Insert Shift:=xlToRight
    Range("BI1").Select
    

End Sub
Sub AdjustValorScoring()

    Dim lastRow As Long

    ' Selecciona la columna AY para ordenarla
    Range("AZ1").Select

    ' Ordena los datos de la hoja por la columna AY (Monitor) de forma ascendente
    ActiveWorkbook.Worksheets("CAM - UNIF REPORTE MULTICAMPAÑA").AutoFilter.Sort. _
        SortFields.Clear
    ActiveWorkbook.Worksheets("CAM - UNIF REPORTE MULTICAMPAÑA").AutoFilter.Sort. _
        SortFields.Add2 Key:=Columns("AZ:AZ"), SortOn:=xlSortOnValues, Order:= _
        xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("CAM - UNIF REPORTE MULTICAMPAÑA").AutoFilter. _
        Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

    ' Encuentra la última fila con datos en la columna AY
    lastRow = ActiveSheet.Cells(Rows.Count, "AZ").End(xlUp).Row

    ' Selecciona y corta el rango dinámico desde AY2 hasta la última fila encontrada,
    ' y hasta la columna BD
    Range("AZ2:BD" & lastRow).Select
    Selection.Cut

    ' Desplaza la vista de la ventana y pega los datos en BD2
    ActiveWindow.SmallScroll Down:=-72
    Range("BE2").Select
    ActiveSheet.Paste

End Sub
Sub AdjustMonitor()

    Dim lastRow As Long

    ' Selecciona la columna AY para ordenarla
    Range("AY1").Select

    ' Ordena los datos de la hoja por la columna AY (Monitor) de forma ascendente
    ActiveWorkbook.Worksheets("CAM - UNIF REPORTE MULTICAMPAÑA").AutoFilter.Sort. _
        SortFields.Clear
    ActiveWorkbook.Worksheets("CAM - UNIF REPORTE MULTICAMPAÑA").AutoFilter.Sort. _
        SortFields.Add2 Key:=Columns("AY:AY"), SortOn:=xlSortOnValues, Order:= _
        xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("CAM - UNIF REPORTE MULTICAMPAÑA").AutoFilter. _
        Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

    ' Encuentra la última fila con datos en la columna AY
    lastRow = ActiveSheet.Cells(Rows.Count, "AY").End(xlUp).Row

    ' Selecciona y corta el rango dinámico desde AY2 hasta la última fila encontrada,
    ' y hasta la columna BD
    Range("AY2:BD" & lastRow).Select
    Selection.Cut

    ' Desplaza la vista de la ventana y pega los datos en BD2
    ActiveWindow.SmallScroll Down:=-72
    Range("BD2").Select
    ActiveSheet.Paste

End Sub
Sub ActiveLines()

    Range("BK2").Select
    Range(Selection, ActiveCell.SpecialCells(xlLastCell)).Select
    Range("BK2:BK1048576").Select
    Selection.TextToColumns Destination:=Range("BK2"), DataType:=xlDelimited, _
        TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=False, _
        Semicolon:=False, Comma:=True, Space:=False, Other:=False, FieldInfo _
        :=Array(1, 1), TrailingMinusNumbers:=True
    Range("BK1").Select

End Sub

Sub Titles()

    Dim specificValue As String
    Dim specificValue2 As String
    specificValue = "Hola"
    specificValue2 = "CRM Origen"
    
    ' Si el valor de A1 es igual a specificValue2, eliminamos la fila 1
    If Range("C1").Value = specificValue2 Then
        Rows("1:1").Delete
    End If
    
    ' Si el valor de A1 no es specificValue, insertamos la fila y colocamos los títulos
    If Range("A1").Value <> specificValue Then
    
        Rows("1:1").Select
        Selection.Insert Shift:=xlDown
        Range("A1").Select
        
        Range("A1").Value = "Número de Cliente"
        Range("B1").Value = "[Account.AccountCode?]"
        Range("C1").Value = "CRM Origen"
        Range("D1").Value = "Edad de Deuda"
        Range("E1").Value = "[PotencialMark?]"
        Range("F1").Value = "[PrePotencialMark?]"
        Range("G1").Value = "[WriteOffMark?]"
        Range("H1").Value = "Monto inicial"
        Range("I1").Value = "[ModInitCta?]"
        Range("J1").Value = "[DeudaRealCuenta?]"
        Range("K1").Value = "[BillCycleName?]"
        Range("L1").Value = "Nombre Campaña"
        Range("M1").Value = "[DebtAgeInicial?]"
        Range("N1").Value = "Nombre Casa de Cobro"
        Range("O1").Value = "Fecha de Asignacion"
        Range("P1").Value = "Deuda Gestionable"
        Range("Q1").Value = "Dirección Completa"
        Range("R1").Value = "Fecha Final "
        Range("S1").Value = "Segmento"
        Range("T1").Value = "[Documento?]"
        Range("U1").Value = "[AccStsName?]"
        Range("V1").Value = "Ciudad"
        Range("W1").Value = "[InboxName?]"
        Range("X1").Value = "Nombre del Cliente"
        Range("Y1").Value = "Id de Ejecucion"
        Range("Z1").Value = "Fecha de Vencimiento"
        
        Range("AA1").Value = "Numero Referencia de Pago"
        Range("AB1").Value = "MIN"
        Range("AC1").Value = "Plan"
        Range("AD1").Value = "Cuotas Aceleradas"
        Range("AE1").Value = "Fecha de Aceleracion"
        Range("AF1").Value = "Valor Acelerado"
        Range("AG1").Value = "Intereses ContingenteS"
        Range("AH1").Value = "Intereses Corrientes Facturados"
        Range("AI1").Value = "Intereses por mora facturados"
        Range("AJ1").Value = "Iva Intereses Contigentes Facturado" ' Anteriormente AK1
        Range("AK1").Value = "Iva Intereses Corrientes Facturados" ' Anteriormente AL1
        Range("AL1").Value = "Iva Intereses por Mora Facturado" ' Anteriormente AM1
        Range("AM1").Value = "Precio Subscripcion" ' Anteriormente AN1
        Range("AN1").Value = "Código de proceso" ' Anteriormente AO1
        Range("AO1").Value = "[CustomerTypeId?]" ' Anteriormente AP1
        Range("AP1").Value = "[RefinanciedMark?]" ' Anteriormente AQ1
        Range("AQ1").Value = "[Discount?]" ' Anteriormente AR1
        Range("AR1").Value = "[Permanencia?]" ' Anteriormente AS1
        Range("AS1").Value = "[DeudaSinPermanencia?]" ' Anteriormente AT1
        Range("AT1").Value = "Telefono 1" ' Anteriormente AU1
        Range("AU1").Value = "Telefono 2" ' Anteriormente AV1
        Range("AV1").Value = "Telefono 3" ' Anteriormente AW1
        Range("AW1").Value = "Telefono 4" ' Anteriormente AX1
        Range("AX1").Value = "Email" ' Anteriormente AY1
        
        Range("AY1").Value = "[ActivesLines]" ' Anteriormente AZ1
        Columns("AZ:BD").Insert Shift:=xlToRight ' Se ajustó el rango de columnas a insertar
        Range("AZ1").Value = "[ActivesLines2]" ' Anteriormente BA1
        Range("BA1").Value = "[ActivesLines3]" ' Anteriormente BB1
        Range("BB1").Value = "[ActivesLines4]" ' Anteriormente BC1
        Range("BC1").Value = "[ActivesLines5]" ' Anteriormente BD1
        Range("BD1").Value = "[ActivesLines6]" ' Anteriormente BE1
        Range("BE1").Value = "[ActivesLines7]" ' Anteriormente BF1
        
        Range("BF1").Value = "Monitor" ' Anteriormente BG1
        Range("BG1").Value = "Valor Scorint" ' Anteriormente BH1
        Range("BH1").Value = "Cuotas Pactadas"
        Range("BI1").Value = "Cuotas Pendientes"
        Range("BJ1").Value = "Fecha Digitacion Activacion"
        
        
    End If
End Sub

Sub Update_Line_Q()
'
' Ordenaciï¿½n de la columna seleccionada
'
'
    Columns("U:U").Select   'Selecciï¿½n de columna [AccStsName?]
    ActiveWorkbook.Worksheets("CAM - UNIF REPORTE MULTICAMPAÑA").Sort.SortFields. _
        Clear
    ActiveWorkbook.Worksheets("CAM - UNIF REPORTE MULTICAMPAÑA").Sort.SortFields. _
        Add2 Key:=Range("U:U"), SortOn:=xlSortOnValues, Order:=xlAscending _
        , DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("CAM - UNIF REPORTE MULTICAMPAÑA").Sort
        .SetRange Range("A:BK")
        .Header = xlNo
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
    'Ordenaciï¿½n completada
    
End Sub

Sub Update_Line_AO()
'
' Ordenaciï¿½n de la columna seleccionada
'
'
    Range("AO1").Select                      'Selecciï¿½n del inicio de pila de la columna de referencia
    Selection.AutoFilter
    ActiveWorkbook.Worksheets("CAM - UNIF REPORTE MULTICAMPAÑA").Sort.SortFields. _
        Clear
    ActiveWorkbook.Worksheets("CAM - UNIF REPORTE MULTICAMPAÑA").Sort.SortFields. _
        Add2 Key:=Range("AO:AO"), SortOn:=xlSortOnValues, Order:=xlAscending _
        , DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("CAM - UNIF REPORTE MULTICAMPAÑA").Sort
        .SetRange Range("A:BK")
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
    'Ordenaciï¿½n completada
    
End Sub

Sub Filter_Q()

'
' Delimtador de columna por signo de ;
'
'
    Range("R1").Select                      'Selecciï¿½n del inicio de pila de la columna de referencia
    Selection.End(xlDown).Select            'Redirecciï¿½n de posiciï¿½n hasta la cola de la pila
    ActiveCell.Offset(1, 0).Select
    ActiveCell.Offset(0, -1).Select
    'Redirecciï¿½n de pocisiï¿½n de acuerdo a los dos pasos que anteceden
    
    Range(Selection, Selection.End(xlDown)).Select
    Selection.TextToColumns Destination:=ActiveCell, DataType:= _
        xlDelimited, TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, _
        Tab:=False, Semicolon:=True, Comma:=False, Space:=False, Other:=False _
        , FieldInfo:=Array(Array(1, 1), Array(2, 1), Array(3, 1), Array(4, 1), Array(5, 1), _
        Array(6, 1), Array(7, 1), Array(8, 1), Array(9, 1), Array(10, 1), Array(11, 1), Array(12, 1) _
        , Array(13, 1), Array(14, 1), Array(15, 1), Array(16, 1), Array(17, 1), Array(18, 1), Array( _
        19, 1), Array(20, 1), Array(21, 1), Array(22, 1), Array(23, 1), Array(24, 1), Array(25, 1), _
        Array(26, 1), Array(27, 1), Array(28, 1), Array(29, 1), Array(30, 1), Array(31, 1), Array( _
        32, 1), Array(33, 1), Array(34, 1), Array(35, 1), Array(36, 1), Array(37, 1)), _
        TrailingMinusNumbers:=True
    
    'Cï¿½digo para delimitar celdas faltantes
    'IMPORTANTE: No se ha configurado para aceptar el mensaje de reemplazar valores
    'Macro se corre paso a paso, aï¿½n no se puede ejecutar de corrido
    
End Sub

Sub Filter_AO()

'
' Delimtador de columna por signo de ;
'
'
    Range("AO1").Select                      'Selecciï¿½n del inicio de pila de la columna de referencia
    Selection.End(xlDown).Select            'Redirecciï¿½n de posiciï¿½n hasta la cola de la pila
    ActiveCell.Offset(1, 0).Select
    ActiveCell.Offset(0, -1).Select
    'Redirecciï¿½n de pocisiï¿½n de acuerdo a los dos pasos que anteceden
    
    Range(Selection, Selection.End(xlDown)).Select
    Selection.TextToColumns Destination:=ActiveCell, DataType:= _
        xlDelimited, TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, _
        Tab:=False, Semicolon:=True, Comma:=False, Space:=False, Other:=False _
        , FieldInfo:=Array(Array(1, 1), Array(2, 1), Array(3, 1), Array(4, 1), Array(5, 1), _
        Array(6, 1), Array(7, 1), Array(8, 1), Array(9, 1), Array(10, 1), Array(11, 1), Array(12, 1) _
        , Array(13, 1), Array(14, 1), Array(15, 1), Array(16, 1), Array(17, 1), Array(18, 1), Array( _
        19, 1), Array(20, 1), Array(21, 1), Array(22, 1), Array(23, 1), Array(24, 1), Array(25, 1), _
        Array(26, 1), Array(27, 1), Array(28, 1), Array(29, 1), Array(30, 1), Array(31, 1), Array( _
        32, 1), Array(33, 1), Array(34, 1), Array(35, 1), Array(36, 1), Array(37, 1)), _
        TrailingMinusNumbers:=True
    
    'Cï¿½digo para delimitar celdas faltantes
    'IMPORTANTE: No se ha configurado para aceptar el mensaje de reemplazar valores
    'Macro se corre paso a paso, aï¿½n no se puede ejecutar de corrido
    
End Sub
Sub Update()
'
' Update Macro
'

'
    Range("AZ1").Select
    Range(Selection, Selection.End(xlToRight)).Select
    Columns("AZ:BJ").Select
    Selection.Cut
    Range("AY1").Select
    Selection.Insert Shift:=xlToRight
    Range("BJ1").Select

' Cutting cells

    Rows("1:1").Select
    Selection.Insert Shift:=xlDown
    Rows("2:2").Select
    Selection.Delete Shift:=xlUp
    Range("A1").Select
    Selection.End(xlToRight).Select
    Range("BK2").Select
    Selection.End(xlDown).Select
    Selection.End(xlUp).Select
    Range("BJ2").Select
    Range(Selection, ActiveCell.SpecialCells(xlLastCell)).Select
    Range("BJ2:BJ1048570").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.TextToColumns Destination:=Range("BK2"), DataType:=xlDelimited, _
        TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=False, _
        Semicolon:=False, Comma:=True, Space:=False, Other:=False, FieldInfo _
        :=Array(1, 2), TrailingMinusNumbers:=True
    Range("BJ1").Select
    
End Sub
Sub Headers()
'
' Headers Macro
'

'
    Dim i As Integer
    Range("A1").Select
    For i = 1 To 68
        Cells(1, i).FormulaR1C1 = i & "_"
    Next i
    Range("BP1").Select

End Sub

Sub FinalHeaders()
'
' Headers Macro
'

'
    Dim i As Integer
    Range("A1").Select
    For i = 1 To 62
        Cells(1, i).FormulaR1C1 = i & "_"
    Next i

End Sub

Sub RenameActiveSheet()
    
    Dim newName As String
    newName = "CAM - UNIF REPORTE MULTICAMPAÑA"
    
    ActiveSheet.Name = newName
    
End Sub

Sub Dates()
    Range("A1").Select
    Selection.End(xlToRight).Select
    Range("BP2").Select
    ActiveCell.Value = Date
    ActiveCell.NumberFormat = "dd/mm/yyyy"
    Range("BP2").Select
    Range(Selection, ActiveCell.SpecialCells(xlLastCell)).Select
    Selection.FillDown
    Call Segment_Type
    Call DatesDelete
End Sub

Sub Segment_Type()
    ' Primer bucle Do: Procesar filas en las que el valor de AD es numérico entre 80 y 89
    Do
        Range("AO2").Select
        Selection.End(xlDown).Select
        ActiveCell.Offset(1, 0).Select
        
        If IsNumeric(Cells(ActiveCell.Row, "AD").Value) And _
           Cells(ActiveCell.Row, "AD").Value >= 80 And _
           Cells(ActiveCell.Row, "AD").Value <= 89 Then
           
            ' Cortar desde la columna R hasta AN de la fila actual y pegarlo en AD (hasta AZ)
            Range("R" & ActiveCell.Row & ":AN" & ActiveCell.Row).Cut _
                Destination:=Range("AD" & ActiveCell.Row)
            
            ' En la columna AZ: formatear como texto y agregar una coma al final
            Range("AZ" & ActiveCell.Row).NumberFormat = "@"
            With Cells(ActiveCell.Row, "AZ")
                .Value = .Value & ","
                .NumberFormat = "@"
            End With
            
            ' Delimitar el contenido de la celda AZ usando TextToColumns (delimitador: punto y coma)
            With Cells(ActiveCell.Row, "AZ")
                .TextToColumns Destination:=.Cells(1, 1), DataType:=xlDelimited, _
                    TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, _
                    Tab:=False, Semicolon:=True, Comma:=False, Space:=False, Other:=False, _
                    FieldInfo:=Array(1, 1), TrailingMinusNumbers:=True
            End With
            
            ' En la columna Q: formatear como texto y agregar un punto y coma al final
            With Cells(ActiveCell.Row, "Q")
                .Value = .Value & ";"
                .NumberFormat = "@"
            End With
            
            ' Delimitar el contenido de la celda Q usando TextToColumns
            With Cells(ActiveCell.Row, "Q")
                .TextToColumns Destination:=.Cells(1, 1), DataType:=xlDelimited, _
                    TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, _
                    Tab:=False, Semicolon:=True, Comma:=False, Space:=False, Other:=False, _
                    FieldInfo:=Array(1, 1), TrailingMinusNumbers:=True
            End With
        End If
        
        ' Salir del bucle si la celda en AD está vacía (no hay más datos)
        If IsEmpty(Cells(ActiveCell.Row, "AD").Value) Then
            Exit Do
        End If
        
    Loop
    
    ' Segundo bucle Do: Procesar filas donde la celda en la columna A NO esté vacía
    Do
        Range("AO2").Select
        Selection.End(xlDown).Select
        ActiveCell.Offset(1, 0).Select
        
        If Not IsEmpty(Cells(ActiveCell.Row, "A").Value) Then
            ' Desplazarse hasta la celda más a la izquierda de la fila actual
            Selection.End(xlToLeft).Select
            With ActiveCell
                .Value = .Value & ";"
                .NumberFormat = "@"
            End With
            
            ' Delimitar el contenido de la celda activa usando TextToColumns
            With ActiveCell
                .TextToColumns Destination:=.Cells(1, 1), DataType:=xlDelimited, _
                    TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, _
                    Tab:=False, Semicolon:=True, Comma:=False, Space:=False, Other:=False, _
                    FieldInfo:=Array(1, 1), TrailingMinusNumbers:=True
            End With
        End If
        
        ' Salir del bucle si la celda en A está vacía
        If IsEmpty(Cells(ActiveCell.Row, "A").Value) Then
            Exit Do
        End If
        
    Loop
End Sub

Sub DatesDelete()
    Do
        Range("BP2").Select
        Selection.End(xlDown).Select
        
        If IsEmpty(Cells(ActiveCell.Row, "A").Value) Then
            Cells(ActiveCell.Row, "BP").ClearContents
        End If
        
        If Not IsEmpty(Cells(ActiveCell.Row, "A").Value) Then
            Exit Do
        End If
        
    Loop
End Sub